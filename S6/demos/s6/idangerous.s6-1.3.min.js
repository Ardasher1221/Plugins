/*
 * S6 1.3 - 3D Mobile Touch Slider
 * http://www.idangero.us/sliders/s6/
 *
 * Copyright 2012, Vladimir Kharlampidi
 * The iDangero.us
 * http://www.idangero.us/
 *
 * Licensed under iDangero.us Regular License (RL):
 * http://www.idangero.us/index.php?content=article&id=21
 *
 * Updated on: October 1, 2012
*/
(function(l){l.fn.s6=function(c){function x(){var a=document.createElement("div");a.id="test3d";var h=!1;"webkitPerspective"in a.style&&(h=!0);"MozPerspective"in a.style&&(h=!0);"OPerspective"in a.style&&(h=!0);"MsPerspective"in a.style&&(h=!0);"perspective"in a.style&&(h=!0);if(h&&"webkitPerspective"in a.style){var c=document.createElement("style");c.textContent="@media (-webkit-transform-3d), (transform-3d), (-moz-transform-3d), (-o-transform-3d), (-ms-transform-3d) {#test3d{height:5px}}";document.getElementsByTagName("head")[0].appendChild(c);
document.body.appendChild(a);h=5===a.offsetHeight;c.parentNode.removeChild(c);a.parentNode.removeChild(a)}return h}function e(){return"horizontal"==a.params.mode}function d(b,c){var i="";switch(c){case "front":i="translate3d(0px, 0px, 0px) rotateY(0deg)";break;case "right":i=e()?"translate3d("+a.width/2+"px, 0px, "+-a.width/2+"px) rotateY(90deg)":"translate3d("+(a.width-a.height/2)+"px, 0px, "+-a.height/2+"px) rotateY(90deg)";break;case "back":i=e()?"translate3d(0px, 0px, "+-a.width+"px) rotateY(180deg)":
"translate3d(0px, 0px, "+-a.height+"px) rotateX(180deg)";break;case "left":i=e()?"translate3d("+-a.width/2+"px, 0px, "+-a.width/2+"px) rotateY(-90deg)":"translate3d("+-a.height/2+"px, 0px, "+-a.height/2+"px) rotateY(-90deg)";break;case "top":i=e()?"translate3d(0px, "+-a.width/2+"px, "+-a.width/2+"px) rotateX(90deg)":"translate3d(0px, "+-a.height/2+"px, "+-a.height/2+"px) rotateX(90deg)";break;case "bottom":i=e()?"translate3d(0px, "+(a.height-a.width/2)+"px, "+-a.width/2+"px) rotateX(-90deg)":"translate3d(0px, "+
a.height/2+"px, "+-a.height/2+"px) rotateX(-90deg)"}var g=b.style;g.webkitTransform=g.MsTransform=g.msTransform=g.MozTransform=g.OTransform=g.transform=i}function s(){var b=e()?j().y:j().x,c=Math.abs(b),c=c-360*Math.floor(c/360),i=a.activeSlide+1>=a.numOfSlides?0:a.activeSlide+1,g=0>a.activeSlide-1?a.numOfSlides-1:a.activeSlide-1,y=a.slides.eq(i),m=y[0],k=a.slides.eq(g),f=k[0];a.slides.each(function(){var b=l(this).index();b!=i&&(b!=g&&b!=a.activeSlide)&&l(this).hide()});if(e()){0==c&&(d(m,"right"),
d(f,"left"));if(90==c||270==c&&0<b)d(m,"back"),d(f,"front");180===c&&(d(m,"left"),d(f,"right"));if(270===c&&0>b||90==c&&0<b)d(m,"front"),d(f,"back")}else{0==c&&(d(m,"bottom"),d(f,"top"));if(90==c||270==c&&0>b)d(m,"back"),d(f,"front");180===c&&(d(m,"top"),d(f,"bottom"));if(270===c&&0<b||90==c&&0>b)d(m,"front"),d(f,"back")}y.show();k.show()}function z(){a.init();a.setSlides();q(!0)}function A(b){if(a.isTouched)return!1;a.isTouched=!0;a.inf&&s();if(!a.params.onlyExternal&&(!a.isSupportTouch()||1==b.targetTouches.length))if(!a.isSupportTouch()&&
a.params.simulateTouch&&b.preventDefault(),a.touches.startX=a.isSupportTouch()?b.targetTouches[0].pageX:b.pageX,a.touches.startY=a.isSupportTouch()?b.targetTouches[0].pageY:b.pageY,n(0),a.rotates.startX=a.rotates.currentX=j().x,a.rotates.startY=a.rotates.currentY=j().y,a.times.start=(new Date).getTime(),p=void 0,c.onTouchStart)c.onTouchStart(a)}function B(b){if(a.isTouched&&!a.params.onlyExternal){if(a.isSupportTouch()&&("undefined"==typeof p&&e()&&(p=!!(p||Math.abs(b.targetTouches[0].pageY-a.touches.startY)>
Math.abs(b.targetTouches[0].pageX-a.touches.startX))),"undefined"==typeof p&&!e()&&(p=!!(p||Math.abs(b.targetTouches[0].pageY-a.touches.startY)<Math.abs(b.targetTouches[0].pageX-a.touches.startX))),p))return;a.params.autoPlay&&a.stopAutoPlay();if(!a.isSupportTouch()||1==b.touches.length){b.preventDefault();a.isSupportTouch();a.touches.currentX=a.isSupportTouch()?b.targetTouches[0].pageX:b.pageX;a.touches.currentY=a.isSupportTouch()?b.targetTouches[0].pageY:b.pageY;a.touches.diffX=a.touches.currentX-
a.touches.startX;a.touches.diffY=a.touches.currentY-a.touches.startY;var b=(!e()?a.touches.diffY*(-90/a.height):0)+1*a.rotates.startX,h=(e()?90*a.touches.diffX/a.width:0)+1*a.rotates.startY;if(a.inf)if(e()){if(90<=Math.abs(h-a.rotates.startY))return}else if(90<=Math.abs(b-a.rotates.startX))return;a.rotates.currentX=b;a.rotates.currentY=h;c.followFinger&&k({x:a.rotates.currentX,y:a.rotates.currentY},!1);if(c.onTouchMove)c.onTouchMove(a)}}}function C(){if(a.isTouched&&(a.isTouched=!1,!a.params.onlyExternal&&
(k({x:a.rotates.currentX,y:a.rotates.currentY},!0),n(a.params.speed),a.rotates.currentY||(a.rotates.currentY=a.rotates.startY),a.rotates.currentX||(a.rotates.currentX=a.rotates.startX),a.rotates.diffY=a.rotates.currentY-a.rotates.startY,a.rotates.diffX=a.rotates.currentX-a.rotates.startX,a.times.end=(new Date).getTime(),a.params.freeMode&&!a.inf?300>a.times.end-a.times.start&&!0==a.params.freeModeFluid&&(e()?0!==Math.abs(a.rotates.diffY)&&(k({y:1*a.rotates.currentY+1*a.rotates.diffY},!0),n(3*(a.times.end-
a.times.start))):0!==Math.abs(a.rotates.diffX)&&(k({x:1*a.rotates.currentX+1*a.rotates.diffX},!0),n(3*(a.times.end-a.times.start)))):(a.rotates.diff=e()?a.rotates.diffY:a.rotates.diffX,a.direction=e()?0>a.rotates.diffY?"toRight":"toLeft":0<a.rotates.diffX?"toRight":"toLeft","toRight"==a.direction&&500>=a.times.end-a.times.start&&(10>Math.abs(a.rotates.diff)?q():a.swipeNext("internal")),"toLeft"==a.direction&&500>=a.times.end-a.times.start&&(10>Math.abs(a.rotates.diff)?q():a.swipePrev("internal")),
"toRight"==a.direction&&500<a.times.end-a.times.start&&(45<=Math.abs(a.rotates.diff)?a.swipeNext("internal"):q()),"toLeft"==a.direction&&500<a.times.end-a.times.start&&(45<=Math.abs(a.rotates.diff)?a.swipePrev("internal"):q())),c.onTouchEnd)))c.onTouchEnd(a)}function q(b){if(e()){var h=90*Math.round(j().y/90);k({y:h},!0,!0);a.rotates.currentY=h}else h=90*Math.round(j().x/90),k({x:h},!0,!0),a.rotates.currentX=h;b&&n(0);if(c.onSlideReset)c.onSlideReset(a)}function t(b){var c=a.wrapper[0],i=["webkitTransitionEnd",
"transitionend","oTransitionEnd","MSTransitionEnd"];if(b)for(var g=function(){b(a);for(var e=0;e<i.length;e++)c.removeEventListener(i[e],g,!1)},e=0;e<i.length;e++)c.addEventListener(i[e],g,!1)}function u(){if(a.inf)var b=a.wrapper.slides.eq(a.activeSlide);else{var c=e()?j().y:j().x,c=c-360*Math.floor(c/360),c=4-c/90,c=4==c?0:c;0==c&&(b=a.wrapper.find(".s6-slide-front"));1==c&&(e()?b=a.wrapper.find(".s6-slide-right"):b=a.wrapper.find(".s6-slide-top"));2==c&&(b=a.wrapper.find(".s6-slide-back"));3==
c&&(e()?b=a.wrapper.find(".s6-slide-left"):b=a.wrapper.find(".s6-slide-bottom"))}a.wrapper.find(".s6-slide-active").removeClass("s6-slide-active");b.addClass("s6-slide-active")}function k(b,h,i,g){i||(i=!1);b||(b={});b.x=b.x||0;b.y=b.y||0;b.z=b.z||0;var d=0,d=e()?-a.width/2:-a.height/2,d=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome")?d:0,f=a.wrapper[0].style;f.webkitTransform=f.MsTransform=f.MozTransform=f.OTransform=f.transform="translate3d(0px,  0px,"+d+"px) rotateX("+
b.x+"deg) rotateY("+b.y+"deg)";!e()&&a.params.dynamicShadow&&(d=Math.abs(b.x),d-=90*Math.floor(d/90),d=1.5-(Math.sin(2*d*Math.PI/360)/2+Math.cos(2*d*Math.PI/360)/2),d=a.params.dynamicShadowScale/d,f=a.shadow[0].style,f.webkitTransform=f.MsTransform=f.MozTransform=f.OTransform=f.transform="scale3d("+c.dynamicShadowScale+", 1, "+d+") translate3d(0px, "+(a.height/2+a.params.dynamicShadowOffset)+"px, "+-a.height/2/d+"px) rotateX(-90deg)");h&&a.wrapper.attr({"data-s6rotatex":b.x,"data-s6rotatey":b.y,"data-s6rotatez":b.z});
if(a.params.freeMode||i)h=a,i=b.x,b=b.y,a.inf?g?(b=a.activeSlide+1>=a.numOfSlides?0:a.activeSlide+1,i=0>a.activeSlide-1?a.numOfSlides-1:a.activeSlide-1,g="next"==g?b:i,a.activeSlide=g):g=a.activeSlide:(g="horizontal"==a.params.mode?b:-i,0<g?(b=Math.floor(g/360),g=4-Math.round((g-360*b)/90)):(b=Math.floor(-g/360),g=Math.round(-(g+360*b)/90)),4==g&&(g=0)),h.activeSlide=g,a.params.pagination&&(g=l(a.params.pagination).find("."+a.params.paginationActiveClass).index(),b=a.activeSlide,g!=b&&(l(a.params.pagination).find("."+
a.params.paginationActiveClass).removeClass(a.params.paginationActiveClass),l(a.params.pagination).children().eq(b).addClass(a.params.paginationActiveClass)))}function j(){return{x:a.wrapper.attr("data-s6rotatex"),y:a.wrapper.attr("data-s6rotatey"),z:a.wrapper.attr("data-s6rotatez")}}function n(b){var c=a.wrapper[0].style;c.webkitTransitionDuration=c.MsTransitionDuration=c.MozTransitionDuration=c.OTransitionDuration=c.transitionDuration=b/1E3+"s";!e()&&a.params.dynamicShadow&&(c=a.shadow[0].style,
c.webkitTransitionDuration=c.MsTransitionDuration=c.MozTransitionDuration=c.OTransitionDuration=c.transitionDuration=b/1E3+"s")}var f=l(this);if(0==f.length)return f;c=c||{};c.speed=c.speed||500;c.simulateTouch=!1===c.simulateTouch?!1:!0;c.freeMode=c.freeMode||!1;c.perspective=c.perspective||1E3;c.mode=c.mode||"horizontal";c.slideClass=c.slideClass||"s6-slide";c.wrapperClass=c.wrapperClass||"s6-wrapper";c.paginationClass=c.paginationClass||"s6-pagination-switch";c.paginationActiveClass=c.paginationActiveClass||
"s6-active-switch";c.autoPlay=c.autoPlay||!1;c.followFinger=!1===c.followFinger?!1:!0;c.createBackFaces=!1===c.createBackFaces?!1:!0;c.createPagination=!1===c.createPagination?!1:!0;!1!==c.setPerspective&&!0!==c.setPerspective&&(c.setPerspective=!0);c.dynamicShadow=c.dynamicShadow||!1;c.dynamicShadowOffset=c.dynamicShadowOffset||20;c.dynamicShadowScale=c.dynamicShadowScale||0.9;var p;if(!(0<f.find(".s6-slide-top").length)){if(!x()&&window.Swiper)return f.css({overflow:"hidden"}),f.find("."+c.slideClass).css("float",
"left").css("position","relative").css("visibility","visible"),new Swiper(f.selector,c);c.faces=c.faces||{};c.faces.left=c.faces.left||"#555";c.faces.right=c.faces.right||"#888";c.faces.top=c.faces.top||"#888";c.faces.bottom=c.faces.bottom||"#555";var a={container:f,wrapper:f.find("."+c.wrapperClass),slides:f.find("."+c.slideClass),params:c,touches:{},rotates:{},times:{},isSupport3D:x(),activeSlide:0,init:function(){a.width=f.width();a.height=f.height();var b=e()?a.width:a.height;a.wrapper.css({width:a.width,
height:a.height,"-moz-transform-origin":a.width/2+"px "+b/2+"px -"+b/2+"px","-webkit-transform-origin":a.width/2+"px "+b/2+"px -"+b/2+"px","-ms-transform-origin":a.width/2+"px "+b/2+"px -"+b/2+"px","-o-transform-origin":a.width/2+"px "+b/2+"px -"+b/2+"px","transform-origin":a.width/2+"px "+b/2+"px -"+b/2+"px"});a.wrapper.find("."+c.slideClass).css({width:a.width,height:a.height})}};a.init();!0===a.params.setPerspective&&a.container.css({"-webkit-perspective":a.params.perspective,"-moz-perspective":a.params.perspective,
"-ms-perspective":a.params.perspective,"-o-perspective":a.params.perspective,perspective:a.params.perspective});a.wrapper.find("."+c.slideClass).css({width:a.width,height:a.height});a.numOfSlides=a.wrapper.find(".s6-slide").length;a.inf=4<a.numOfSlides?!0:!1;a.inf&&a.slides.not(":eq(0)").hide();a.setSlides=function(){a.slides.each(function(){l(this).removeClass("s6-slide-top").removeClass("s6-slide-left").removeClass("s6-slide-right").removeClass("s6-slide-bottom").removeClass("s6-slide-front").removeClass("s6-slide-back")});
a.inf?a.slides.eq(0).addClass("s6-slide-front"):(a.slides.eq(0).addClass("s6-slide-front"),a.slides.eq(2).addClass("s6-slide-back"),e()?(a.slides.eq(1).addClass("s6-slide-right"),a.slides.eq(3).addClass("s6-slide-left")):(a.slides.eq(1).addClass("s6-slide-bottom"),a.slides.eq(3).addClass("s6-slide-top")));a.slides.each(function(){if(!a.inf){var b=l(this),c=b[0];b.hasClass("s6-slide-right")&&d(c,"right");b.hasClass("s6-slide-left")&&d(c,"left");b.hasClass("s6-slide-back")&&d(c,"back");b.hasClass("s6-slide-top")&&
d(c,"top");b.hasClass("s6-slide-bottom")&&d(c,"bottom")}});if(a.params.dynamicShadow){0<a.container.find(".s6-dynamic-shadow").length&&a.container.find(".s6-dynamic-shadow").remove();var b=a.params.dynamicShadowScale,h=a.params.dynamicShadowOffset;e()?a.wrapper.append('<div class="s6-dynamic-shadow"></div>'):a.container.append('<div class="s6-dynamic-shadow"></div>');a.shadow=a.container.find(".s6-dynamic-shadow");b=e()?"scale3d("+b+", 1, "+b+") translate3d(0px, "+(a.height-a.width/2+h)+"px, "+-a.width/
2/b+"px) rotateX(-90deg)":"scale3d("+b+", 1, "+b+") translate3d(0px, "+(a.height/2+h)+"px, "+-a.height/2/b+"px) rotateX(-90deg)";h=a.shadow[0].style;h.webkitTransform=h.MsTransform=h.MozTransform=h.OTransform=h.transform=b;h.width=a.width+"px";h.height=(e()?a.width:a.height)+"px"}e()?a.params.createBackFaces&&(a.wrapper.find(".s6-slide-top, .s6-slide-bottom").remove(),a.wrapper.append('<div class="'+a.params.slideClass+' s6-slide-top"></div><div class="'+a.params.slideClass+' s6-slide-bottom"></div>'),
a.wrapper.find(".s6-slide-top").css({width:a.width,height:a.width,background:c.faces.top}),b=a.wrapper.find(".s6-slide-top")[0],d(b,"top"),a.wrapper.find(".s6-slide-bottom").css({width:a.width,height:a.width,background:c.faces.bottom}),b=a.wrapper.find(".s6-slide-bottom")[0],d(b,"bottom")):a.params.createBackFaces&&(a.wrapper.find(".s6-slide-left, .s6-slide-right").remove(),a.wrapper.append('<div class="'+a.params.slideClass+' s6-slide-left"></div><div class="'+a.params.slideClass+' s6-slide-right"></div>'),
a.wrapper.find(".s6-slide-left").css({width:a.height,height:a.height,background:c.faces.left}),b=a.wrapper.find(".s6-slide-left")[0],d(b,"left"),a.wrapper.find(".s6-slide-right").css({width:a.height,height:a.height,background:c.faces.right}),b=a.wrapper.find(".s6-slide-right")[0],d(b,"right"))};a.setSlides();a.wrapper.find("."+a.params.slideClass).css({visibility:"visible"});a.params.disableAutoResize||(l(window).resize(function(){a.init();a.setSlides()}),window.addEventListener("resize",z,!1));a.wrapper.find(".s6-slide-front").addClass("s6-slide-active");
if(!1!=a.params.pagination){if(a.params.createPagination){for(var v="",D=1;D<=a.slides.length;D++)v+='<span class="'+a.params.paginationClass+'"></span>';l(a.params.pagination).html(v)}l(a.params.pagination).children().eq(0).addClass(a.params.paginationActiveClass)}a.isSupportTouch=function(){return"ontouchstart"in window};var E=a.isSupportTouch()||!a.params.simulateTouch?"touchstart":"mousedown",F=a.isSupportTouch()||!a.params.simulateTouch?"touchmove":"mousemove",G=a.isSupportTouch()||!a.params.simulateTouch?
"touchend":"mouseup",w;a.startAutoPlay=function(){a.params.autoPlay&&(w=setInterval(function(){a.swipeNext()},a.params.autoPlay))};a.stopAutoPlay=function(){w&&clearInterval(w)};a.params.autoPlay&&a.startAutoPlay();a.container[0].addEventListener(E,A,!1);var r=a.isSupportTouch()?a.container[0]:document;r.addEventListener(F,B,!1);r.addEventListener(G,C,!1);a.destroy=function(){a.container[0].removeEventListener(E,A,!1);r.removeEventListener(F,B,!1);r.removeEventListener(G,C,!1);window.removeEventListener("resize",
z,!1)};k({x:0,y:0,z:0},!0);a.swipeNext=function(b){a.inf&&"internal"!=b&&s();e()?(b=90*Math.ceil(j().y/90)-90,k({y:b},!0,!0,"next"),a.rotates.currentY=b):(b=Math.ceil(j().x/90)==j().x/90?90:0,b=90*Math.ceil(j().x/90)+b,k({x:b},!0,!0,"next"),a.rotates.currentX=b);u();n(a.params.speed);if(c.onSlideChangeStart)c.onSlideChangeStart(a);c.onSlideChangeEnd&&t(c.onSlideChangeEnd)};a.swipePrev=function(b){a.inf&&"internal"!=b&&s();e()?(b=90*Math.floor(j().y/90)+90,k({y:b},!0,!0,"prev"),a.rotates.currentY=
b):(b=Math.ceil(j().x/90)==j().x/90?-90:0,b=90*Math.floor(j().x/90)+b,k({x:b},!0,!0,"prev"),a.rotates.currentX=b);u();n(a.params.speed);if(c.onSlideChangeStart)c.onSlideChangeStart(a);c.onSlideChangeEnd&&t(c.onSlideChangeEnd)};a.swipeTo=function(b){if(b!=a.activeSlide){var d=e()?j().y:j().x,f=360*Math.floor(d/360),g=90*b,b=f-g;e()||(b=f+g);f="next";b>d&&(f="prev");e()?(k({y:b},!0,!0,f),a.rotates.currentY=b):(k({x:b},!0,!0,f),a.rotates.currentX=b);u();n(a.params.speed);if(c.onSlideChangeStart)c.onSlideChangeStart(a);
c.onSlideChangeEnd&&t(c.onSlideChangeEnd)}};return a}}})(window.jQuery||window.Zepto);